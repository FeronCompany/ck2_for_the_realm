
########## Aid Liege #########
aid_my_lord_interaction = {
	icon = icon_gold
	category = interaction_category_vassal
	common_interaction = yes
	ignores_pending_interaction_block = no
	desc = aid_my_lord_interaction_desc
	greeting = positive
	notification_text = VASSAL_AID_LIEGE
	ai_targets = {
		ai_recipients = liege
	}
	ai_frequency = 24

	is_shown = {
		NOT = { scope:actor = scope:recipient }
		scope:actor = {
			NOT = { this = scope:recipient }
			liege = scope:recipient
		}
		scope:recipient = {
			gold < 100
		}
	}

	is_valid_showing_failures_only = {
		scope:actor.gold >= 300
		NOT = { scope:actor = { is_at_war_with = scope:recipient } } 
	}

	on_accept = {
		scope:actor = {
			send_interface_message = {
				type = event_generic_neutral
				title = aid_my_lord_interaction_notification
				right_icon = scope:recipient
				send_interface_toast = {
					title = liege_accept_my_fund_support
					left_icon = scope:actor					
					right_icon = scope:recipient
					pay_short_term_gold = {
						gold = 300
						target = scope:recipient
					}
					stress_impact = {
						greedy = medium_stress_impact_gain
						generous = medium_stress_impact_loss
					}
					scope:recipient = {
						if = {
							limit = {
								scope:gain_hook = yes
							}
							scope:actor = {
								add_hook = { #Hook effect must match gain_hook option condition
									target = scope:recipient
									type = favor_hook
								}
							}
						}
						else = {
							add_opinion = {
								target = scope:actor
								modifier = gift_opinion
								opinion = send_gift_opinion
							}
						}
					}
				}
			}

			# Warning for multiple gifts
			if = {
				limit = {
					scope:recipient = {
						has_opinion_modifier = {
							target = scope:actor
							modifier = gift_opinion
						}
					}
				}
				custom_tooltip = ALREADY_SENT_GIFT_WARNING
			}
		}
	}
	send_option = {
		flag = gain_hook
		localization = "AID_LIEGE_GAIN_HOOK"
		is_valid = {
			scope:actor = {
				can_add_hook = {
					type = favor_hook
					target = scope:recipient
				}
			}
		}
	}
	send_option = {
		flag = help
		localization = "JUST_HELP_LIEGE"
	}
	on_decline = {}

	ai_accept = {
		base = 40
		modifier = {
			add = 50
			trigger = {
				scope:recipient = {
					gold < -50
				}
			}
			desc = "GOLD_REASON"
		}
		modifier = {
			add = -50
			trigger = {
				scope:gain_hook = yes
			}
			desc = "GAIN_HOOK_NEGATIVE_REASON"
		}
	}

	ai_will_do = {
		base = 50
		modifier = { # Do not send double-gifts
			factor = 0
			scope:recipient = {
				has_opinion_modifier = {
					target = scope:actor
					modifier = gift_opinion
				}
			}
		}
		modifier = { # Bad relation
			factor = 0
			scope:actor = {
				opinion = {
					target = scope:recipient
					value <= 20
				}
			}
		}
		modifier = {
			add = 50
			scope:gain_hook = yes
		}
	}
}

########## Combat Guidance #########
request_combat_guidance_interaction = {
	icon = icon_combat
	category = interaction_category_friendly
	desc = request_combat_guidance_interaction_desc
	scheme = combat_guide
	send_name = START_SCHEME
	greeting = positive
	notification_text = GUIDE_ME_ON_PROWESS
	cooldown = { years = 2 }
	ignores_pending_interaction_block = no
	ai_targets = {
		ai_recipients = vassals
		ai_recipients = peer_vassals
		ai_recipients = liege
		ai_recipients = guests
		ai_recipients = courtiers
		chance = 0.25
	}
	ai_frequency = 36

	is_shown = {
		NOT = { scope:actor = scope:recipient }
		scope:actor = {
			primary_title.tier > tier_barony
			is_adult = yes
			OR = {
				has_trait = education_martial
				culture = { has_cultural_parameter = can_duel_rivals }
			}
			prowess < scope:recipient.prowess
		}
		scope:recipient = {
			prowess >= 12
		}
	}

	is_valid_showing_failures_only = {
		scope:actor.gold >= 150
		NOT = { scope:actor = { is_at_war_with = scope:recipient } } 
	}

	ai_accept = {
		base = -40
		opinion_modifier = {
			opinion_target = scope:actor
			who = scope:recipient
			multiplier = 0.5
			desc = AI_OPINION_REASON
		}
		modifier = {
			add = 50
			trigger = {
				scope:recipient = {
					gold < 20
				}
			}
			desc = GOLD_REASON
		}
	}

	ai_will_do = {
		base = 0
		modifier = {
			add = -10
			scope:actor = {
				has_trait = shy
			}
		}
		modifier = {
			add = -20
			scope:actor = {
				has_trait = lazy
			}
		}
		modifier = {
			add = -30
			scope:actor = {
				has_trait = content
			}
		}
		modifier = {
			add = -10
			scope:actor = {
				has_trait = craven
			}
		}
		modifier = {
			add = 10
			scope:actor = {
				has_trait = ambitious
			}
		}
		modifier = {
			add = 10
			scope:actor = {
				has_trait = brave
			}
		}
		modifier = {
			add = 10
			scope:actor = {
				has_trait = humble
			}
		}
		modifier = {
			add = 10
			scope:actor = {
				has_trait = diligent
			}
		}
	}

	on_accept = {
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = request_combat_guidance_interaction_notification
					left_icon = scope:actor					
					right_icon = scope:recipient
					start_scheme = {
						type = combat_guide
						target = scope:recipient
					}
					pay_short_term_gold = {
						gold = 150
						target = scope:recipient
					}
					stress_impact = {
						greedy = medium_stress_impact_gain
						lazy = medium_stress_impact_gain
					}
				}
			}
		}
		scope:actor = {
			add_opinion = {
				target = scope:recipient
				modifier = ftr_guide_me_on_prowess_opinion
			}
		}
	}
	on_decline = {
		# nothing happen for now
	}
}

########## Religious Debate #########
religious_debate_interaction = {
	category = interaction_category_religion
	common_interaction = yes
	ignores_pending_interaction_block = no
	desc = religious_debate_interaction_desc
	greeting = positive
	notification_text = SOMEONE_START_RELIGIOUS_DEBATE
	ai_targets = {
		ai_recipients = vassals
		ai_recipients = peer_vassals
		ai_recipients = liege
	}
	ai_frequency = 36

	is_shown = {
		NOT = { scope:actor.faith = scope:recipient.faith }
		scope:actor = { is_imprisoned = no }
		scope:recipient = { is_imprisoned = no }
		NOT = {
			scope:recipient = scope:recipient.faith.religious_head
		}
		scope:actor = {
			OR = {
				has_perk = faithful_perk
				has_trait = zealous
			}
		}
		scope:actor.top_liege = scope:recipient.top_liege
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			NOT = { is_at_war_with = scope:recipient }
		}
	}

	on_send = {
		scope:recipient = {
			add_character_flag = {
				flag = flag_recent_start_religious_debate
				days = 365
			}
		}
	}

	on_accept = {
		hidden_effect = {
			scope:actor = {
				trigger_event = ftr_interaction_event.0001
			}
		}
	}

	on_decline = {}

	#auto_accept = {}
	ai_accept = {
		base = 10
		modifier = {
			add = 50
			trigger = {
				scope:recipient = {
					has_trait = zealous
				}
			}
			desc = "FOR_THE_FAITH"
		}
		modifier = {
			add = -50
			trigger = {
				scope:recipient = {
					has_trait = cynical
				}
			}
			desc = "NOT_CARE_ABOUT_RELIGION"
		}
		modifier = {
			add = -100
			trigger = {
				scope:recipient = {
					has_character_flag = flag_recent_start_religious_debate
				}
			}
			desc = "RECENT_RELIGIOUS_DEBATE"
		}
	}

	ai_will_do = {
		base = 10
		modifier = {
			add = -50
			trigger = {
				scope:actor = {
					has_trait = cynical
				}
			}
		}
		modifier = {
			add = 50
			trigger = {
				scope:actor = {
					has_trait = zealous
				}
			}
		}
		modifier = {
			add = -100
			trigger = {
				scope:actor = {
					has_character_flag = flag_recent_start_religious_debate
				}
			}
		}
	}
}

######### Convert Bureacrat to Feudal ##########
ftr_convert_bureacrat_to_feudal_interaction = {
	category = interaction_category_vassal
	common_interaction = yes
	desc = ftr_convert_bureacrat_to_feudal_interaction_desc
	is_shown = {
		NOT = { scope:actor = scope:recipient }
		scope:recipient = {
			is_vassal_of = scope:actor
			has_government = centralism_government
		}
		scope:actor = {
			has_government = centralism_government
			is_independent_ruler = yes
		}
	}
	on_accept = {
		scope:actor = {
			add_prestige = -150
			save_scope_as = liege
		}
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = ftr_grant_here_privilage_opinion
			}
			trigger_event = {
				id = ftr_realm_event.1003
			}
		}
	}
	on_decline = {}
	auto_accept = yes
	ai_will_do = {
		base = -40
		modifier = {
			add = 20
			scope:actor = {
				opinion = {
					target = scope:recipient
					value >= 50
				}
			}
		}
		modifier = {
			add = 20
			scope:actor = {
				has_trait = generous
			}
		}
		modifier = {
			add = 20
			scope:actor = {
				is_parent_of = scope:recipient
			}
		}
	}
}

######### Depose Bureacrat ##########
ftr_depose_bureacrat_interaction = {
	category = interaction_category_vassal
	common_interaction = yes
	desc = ftr_depose_bureacrat_interaction_desc
	populate_actor_list = {
		scope:actor = {
			every_courtier = {
				limit = {
					is_adult = yes
					is_physically_able = yes
					can_be_granted_titles_by = { RULER = scope:actor }
					NOT = { has_council_position = councillor_court_chaplain }
				}
				add_to_list = characters
			}
		}
	}
	is_shown = {
		NOT = { scope:actor = scope:recipient }
		scope:recipient = {
			is_vassal_of = scope:actor
			has_government = centralism_government
		}
		scope:actor = {
			has_government = centralism_government
			is_independent_ruler = yes
		}
	}
	on_accept = {
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = no
		}
		scope:actor = {
			add_prestige = -500
			save_scope_as = liege
			scope:secondary_actor = {
				add_opinion = {
					target = scope:actor
					modifier = ftr_promote_me_opinion
				}
				save_scope_as = successor
			}
			scope:recipient = {
				add_opinion = {
					target = scope:actor
					modifier = ftr_depose_bureacrat_opinion
				}
				every_held_title = {
					limit = {
						has_title_law = bureacratic_succession_law
						tier >= tier_county
					}
					change_title_holder = {
						holder = scope:secondary_actor
						change = scope:change
					}
				}
				every_vassal = {
					change_liege = {
						liege = scope:secondary_actor
						change = scope:change
					}
				}
				scope:recipient = {
					trigger_event = {
						id = ftr_realm_event.1004
						days = 1
					}
				}
			}
		}
		resolve_title_and_vassal_change = scope:change
		scope:secondary_actor = {
			change_government = centralism_government
			add_realm_law = centralism_vassal_succession_law
		}
	}
	on_auto_accept = {}
	on_decline = {}
	auto_accept = yes
	ai_will_do = {
		base = 0
		modifier = {
			add = 50
			scope:actor = {
				opinion = {
					target = scope:recipient
					value <= 0
				}
			}
		}
		modifier = {
			add = 50
			scope:recipient = {
				opinion = {
					target = scope:actor
					value <= 10
				}
			}
		}
	}
}
